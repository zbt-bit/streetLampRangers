<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Street Light Fleet Management Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f7f6; }
        .dashboard-header { background-color: #17a2b8; color: white; padding: 20px; margin-bottom: 20px; }
        .card { border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.05); }
        .status-on { color: #28a745; font-weight: bold; }
        .status-dim { color: #ffc107; font-weight: bold; }
        .status-off { color: #6c757d; font-weight: bold; }
        .status-error { color: #dc3545; font-weight: bold; animation: pulse 1s infinite; }
        .form-switch .form-check-input { width: 3.5em; height: 2em; }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">AI Light Central</a>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="overview.html">Overview</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Single Lamp Control</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">

        <div class="row mb-5">
            <div class="col-12">
                <div class="card p-4 border-warning border-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h4 class="text-danger">üö® Emergency Global Override</h4>
                            <p class="mb-0 text-muted">Toggle this switch to force all lamps to MAX OUTPUT for emergencies, overriding the AI.</p>
                        </div>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="global-override-switch">
                            <label class="form-check-label ms-3 fs-5" for="global-override-switch" id="override-label">AI ACTIVE</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <h2 class="mb-4">Fleet Performance Summary</h2>
        <div class="row mb-5" id="summary-cards"></div>

        <hr>

        <h2 class="mb-4 text-danger">‚ö†Ô∏è Exceptions and Maintenance Alerts</h2>
        <div class="card p-3 mb-4">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Zone ID</th>
                            <th>Status</th>
                            <th>Last Action</th>
                            <th>Alert Type</th>
                            <th>Action Required</th>
                        </tr>
                    </thead>
                    <tbody id="exceptions-list"></tbody>
                </table>
            </div>
        </div>

        <hr>

        <h2 class="mb-4">Standard Zone Dashboard</h2>
        <div class="card p-3">
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Zone ID</th>
                            <th>Location</th>
                            <th>AI Mode</th>
                            <th>Weather</th>
                            <th>Total Lamps</th>
                            <th>Lamps ON</th>
                            <th>Lamps DIM</th>
                            <th>Lamps OFF</th>
                        </tr>
                    </thead>
                    <tbody id="zone-status-table"></tbody>
                </table>
            </div>
        </div>

    </div>

    <script>
        let isGlobalOverrideActive = false;

        const INITIAL_MOCK_FLEET_DATA = {
            totalLamps: 1500,
            totalPowerSavings: "6,000 kWh (Est.)",
            maintenanceRequired: 5,
            zones: [
                { id: "Z-101", location: "Main Street", aiMode: "ACTIVE", weather: "Clear", total: 250, on: 0, dim: 0, off: 250, status: "Normal" },
                { id: "Z-102", location: "Industrial Park", aiMode: "ACTIVE", weather: "Heavy Rain", total: 400, on: 400, dim: 0, off: 0, status: "Safety Override (Rule 2)" },
                { id: "Z-204", location: "Residential North", aiMode: "ACTIVE", weather: "Cloudy", total: 500, on: 0, dim: 0, off: 500, status: "Normal" },
                { id: "Z-311", location: "Downtown Core", aiMode: "ACTIVE", weather: "Clear", total: 350, on: 0, dim: 0, off: 350, status: "Normal" },
                { id: "Z-400", location: "Highway Exit", aiMode: "ACTIVE", weather: "Clear", total: 50, on: 0, dim: 0, off: 50, status: "Normal" },
            ],
            exceptions: [
                { id: "L-204-12", status: "Failed", action: "ON", alert: "Hardware Failure", required: "Schedule Repair" },
                { id: "Z-101-05", status: "ON", action: "OFF", alert: "Logic Anomaly", required: "Check Sensor/Clock" },
                { id: "L-311-20", status: "Failed", action: "DIM", alert: "Circuit Fault", required: "Urgent Inspection" },
                { id: "L-400-01", status: "Failed", action: "ON", alert: "Hardware Failure", required: "Schedule Repair" },
            ]
        };

        function getCurrentFleetData() {
            if (!isGlobalOverrideActive) return INITIAL_MOCK_FLEET_DATA;

            const overrideData = JSON.parse(JSON.stringify(INITIAL_MOCK_FLEET_DATA));

            overrideData.zones.forEach(zone => {
                zone.aiMode = "MANUAL OVERRIDE";
                zone.status = "MAX OUTPUT (Manual)";
                zone.on = zone.total;
                zone.dim = 0;
                zone.off = 0;
            });

            overrideData.aiModeStatus = "Manual Override";
            return overrideData;
        }

        function renderSummaryCards(data) {
            const cardsContainer = document.getElementById('summary-cards');
            cardsContainer.innerHTML = '';

            const aiMode = isGlobalOverrideActive ? "MANUAL OVERRIDE" : "ACTIVE";
            const aiBg = isGlobalOverrideActive ? "bg-warning" : "bg-info";

            const summaryData = [
                { title: "Total Lamps Deployed", value: data.totalLamps.toLocaleString(), icon: "üí°", bgClass: "bg-primary" },
                { title: "Lamps Needing Maintenance", value: data.exceptions.length, icon: "üõ†Ô∏è", bgClass: "bg-danger" },
                { title: "Total Estimated Power Savings", value: data.totalPowerSavings, icon: "‚ö°", bgClass: "bg-success" },
                { title: "Fleet AI Mode", value: aiMode, icon: "üß†", bgClass: aiBg },
            ];

            summaryData.forEach(item => {
                cardsContainer.innerHTML += `
                    <div class="col-md-3 mb-3">
                        <div class="card text-white ${item.bgClass}">
                            <div class="card-body">
                                <h5 class="card-title">${item.icon} ${item.title}</h5>
                                <h2 class="card-text">${item.value}</h2>
                            </div>
                        </div>
                    </div>`;
            });

            document.getElementById('override-label').textContent = aiMode;
        }

        function renderExceptions(exceptions) {
            const list = document.getElementById('exceptions-list');
            list.innerHTML = '';

            exceptions.forEach(entry => {
                list.innerHTML += `
                    <tr>
                        <td>${entry.id}</td>
                        <td class="${entry.status === 'Failed' ? 'status-error' : 'status-dim'}">${entry.status}</td>
                        <td>${entry.action}</td>
                        <td class="text-danger">${entry.alert}</td>
                        <td><button class="btn btn-sm btn-danger">${entry.required}</button></td>
                    </tr>`;
            });
        }

        function renderZoneStatus(zones) {
            const table = document.getElementById('zone-status-table');
            table.innerHTML = '';

            zones.forEach(zone => {
                const statusClass = zone.aiMode.includes('OVERRIDE') ? 'text-warning' : 'text-success';

                table.innerHTML += `
                    <tr>
                        <td>${zone.id}</td>
                        <td>${zone.location}</td>
                        <td class="${statusClass}">${zone.aiMode}</td>
                        <td>${zone.weather}</td>
                        <td>${zone.total}</td>
                        <td class="status-on">${zone.on}</td>
                        <td class="status-dim">${zone.dim}</td>
                        <td class="status-off">${zone.off}</td>
                    </tr>`;
            });
        }

        function toggleGlobalOverride() {
            isGlobalOverrideActive = document.getElementById('global-override-switch').checked;
            if (isGlobalOverrideActive) alert("EMERGENCY OVERRIDE ACTIVATED. All lamps forced to ON.");
            initDashboard();
        }

        function initDashboard() {
            const data = getCurrentFleetData();
            renderSummaryCards(data);
            renderExceptions(data.exceptions);
            renderZoneStatus(data.zones);
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('global-override-switch').addEventListener('change', toggleGlobalOverride);
            initDashboard();
        });
    </script>

</body>
</html>
